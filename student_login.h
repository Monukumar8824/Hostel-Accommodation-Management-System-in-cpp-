#ifndef STUDENTLOGIN_H
#define STUDENTLOGIN_H


#include <iostream>
#include <fstream>
#include <string>
#include <cstring>
#include <windows.h>
#include <conio.h>
#include <cstdlib>
#include <limits>
#include <ctime>
#include <iomanip>

#include "StudentRecord.h"
#include "Student.h"
#include "Room.h"
#include "Fee.h"
#include "MessMenu.h"


#define n 40
using namespace std;

class student_login {
    string name;
    string student_id;
public:
    void pause() {
        cout << "\nPress Enter to continue...";
        cin.ignore();
    }

    bool validate(const string &id, const string &nm) {
        fstream f;
        f.open("students.dat", ios::in | ios::binary);
        if (!f) {
            cout << "Could not open file\n";
            return false;
        }
        StudentRecord rec;
        while (f.read((char*)&rec, sizeof(rec))) {
            if (id == rec.StudentId && nm == rec.name) {
                f.close();
                return true;
            }
        }
        f.close();
        return false;
    }

    void studInfo(const string &id) {
        fstream f;
        f.open("students.dat", ios::in | ios::binary);
        if (!f) {
            cout << "Could not open file\n";
            return;
        }
        StudentRecord rec;
        while (f.read((char*)&rec, sizeof(rec))) {
            if (id == rec.StudentId) {
                cout << "\n======================================================== STUDENT PROFILE =========================================\n";
                cout << "\n+------------+----------------------+------------+---------------+----------+\n";
                cout << "| Student ID | Name                 | Roll No.   | Branch        | Room No. |\n";
                cout << "+------------+----------------------+------------+---------------+----------+\n";

           cout << "| " << setw(10) << left << rec.StudentId << " | "
                << setw(20) << left << rec.name      << " | "
                << setw(10) << left << rec.roll      << " | "
                << setw(13) << left << rec.branch    << " | "
                << setw(8)  << left << rec.room      << " |\n";
           
           cout << "+------------+----------------------+------------+---------------+----------+\n";
           break;
            }
        }
        f.close();
        pause();
    }

    void feeInfo(const string &id) {
        fstream f;
        f.open("students.dat", ios::in | ios::binary);
        if (!f) {
            cout << "Error opening students.dat\n";
            return;
        }
        StudentRecord rec;
        while (f.read((char*)&rec, sizeof(rec))) {
            if (id == rec.StudentId) {
                cout << "\n================================================ FEE DETAILS =====================================================\n";
                cout << "\n+------------+------------+------------+\n";
                cout << "| Total Fee  | Paid Fee   | Due Fee    |\n";
                cout << "+------------+------------+------------+\n";

         cout << "| " << setw(10) << left << rec.totalFee << " | "
              << setw(10) << left << rec.paidFee  << " | "
              << setw(10) << left << rec.dueFee   << " |\n";
         
        cout << "+------------+------------+------------+\n";
        break;
            }  
        }
        f.close();
        pause();
    }

    void messInfo(const string &id) {
        fstream f;
        f.open("messmenu.dat", ios::in | ios::binary);
        if (!f) {
            cout << "Error opening menu.dat\n";
            return;
        }
         MessMenu m;
         bool found = false;
         while(f.read((char*)&m, sizeof(m))) {
            if (id == m.id) {
             if (!found) {  
                cout << "\n================================================ FEE DETAILS =====================================================\n";
                cout << "+------+--------------+------------------------------+------------+--------+\n";
                cout << "| ID   | Date         | Item                         | Food Type  | Qty    |\n";
                cout << "+------+--------------+------------------------------+------------+--------+\n";
                found = true;
             } 
                cout << "| " << left << setw(4) << m.id << " | "
                     << left << setw(12) << m.date << " | "
                     << left << setw(28) << m.item << " | "
                     << left << setw(10) << m.foodtype << " | "
                     << left << setw(6) << m.quanty << " |\n";
                
            }
         }

 if (found) {
        cout << "+------+--------------+------------------------------+------------+--------+\n";
    } else {
        cout << "No mess records found for this student.\n";
    }
         f.close();
         pause();
    }

    void roomInfo(const string &id) {
        fstream f;
        f.open("students.dat", ios::in | ios::binary);
        if (!f) {
            cout << "Could not open file\n";
            return;
        }
        StudentRecord rec;
        while (f.read((char*)&rec, sizeof(rec))) {
            if (id == rec.StudentId) {
                cout << "\n============================= ROOM INFORMATION ===========================================\n";
                 cout << "\n+----------+\n";
                 cout << "| Room No. |\n";
                 cout << "+----------+\n";

                 cout << "| " << setw(8) << left << rec.room << " |\n";

                 cout << "+----------+\n";
                 break;
            }
        }
        f.close();
        pause();
    }

    void menu(const string &id, const string &nm) {
        int choice;
        do {
            system("cls");
            cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
            cout << "\033[1;34m\n\n                                                        HOSTEL ACCOMMODATION MANAGEMENT SYSTEM                                                                               \033[0m\n";
            cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
            cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
            cout << "\033[1;34m\n                                                               STUDENT MANAGEMENT                                                                                              \033[0m\n";
            cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
            cout << " 1. STUDENT(ITSELF) INFORMATION\n"
                 << " 2. STUDENT FEE INFORMATION\n"
                 << " 3. STUDENT ROOM INFORMATION\n"
                 << " 4. STUDENT MESS INFORMATION\n"
                 << " 5. LOGOUT\n";
            cout << "\033[1;36m\n===============================================================================================================================================================================\033[0m\n";
            cout << "ENTER YOUR CHOICE: ";
            cin >> choice;
            cin.ignore();

            switch (choice) {

                        system("cls");
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                        cout << "\033[1;34m\n\n                                                        HOSTEL ACCOMMODATION MANAGEMENT SYSTEM                                                                               \033[0m\n";
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                        cout << "\033[1;34m\n                                                               STUDENT MANAGEMENT                                                                                              \033[0m\n";
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                case 1: cout << "1.  *********************  STUDENT(ITSELF) INFORMATION    *********************\n ";
                        studInfo(id); 
                        break;
                        system("cls");
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                        cout << "\033[1;34m\n\n                                                        HOSTEL ACCOMMODATION MANAGEMENT SYSTEM                                                                               \033[0m\n";
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                        cout << "\033[1;34m\n                                                               STUDENT MANAGEMENT                                                                                              \033[0m\n";
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                case 2: cout << "2.  *********************  STUDENT HOSTEL FEE INFORMATION    *********************\n ";
                        feeInfo(id);  
                        break;
                        system("cls");
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                        cout << "\033[1;34m\n\n                                                        HOSTEL ACCOMMODATION MANAGEMENT SYSTEM                                                                               \033[0m\n";
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                        cout << "\033[1;34m\n                                                               STUDENT MANAGEMENT                                                                                              \033[0m\n";
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                case 3: cout << "3.  *********************  STUDENT ROOM INFORMATION  *********************\n ";
                        roomInfo(id); 
                        break;
                        system("cls");
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                        cout << "\033[1;34m\n\n                                                        HOSTEL ACCOMMODATION MANAGEMENT SYSTEM                                                                               \033[0m\n";
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                        cout << "\033[1;34m\n                                                               STUDENT MANAGEMENT                                                                                              \033[0m\n";
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                case 4: cout << "4.  *********************  STUDENT MESS INFORMATION  *********************\n ";
                        messInfo(id);
                        break;
                        system("cls");
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                        cout << "\033[1;34m\n\n                                                        HOSTEL ACCOMMODATION MANAGEMENT SYSTEM                                                                               \033[0m\n";
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                        cout << "\033[1;34m\n                                                               STUDENT MANAGEMENT                                                                                              \033[0m\n";
                        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
                case 5: cout << "5. Logging out...\n"; 
                        break;
                default: cout << "Invalid choice.\n"; 
                         pause();
            }
        } while (choice != 5);
    }

    void login() {
        system("cls");
        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
        cout << "\033[1;34m\n\n                                                        HOSTEL ACCOMMODATION MANAGEMENT SYSTEM                                                                               \033[0m\n";
        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
        cout << "\033[1;34m\n                                                                   STUDENT LOGIN ACCOUNT                                                                                       \033[0m\n";
        cout << "\033[1;33m\n===============================================================================================================================================================================\033[0m\n";
        cin.ignore();
        cout << "Enter your Name: ";
        getline(cin, name);
        cout << "Enter your Student ID: ";
        getline(cin, student_id);

        if (validate(student_id, name)) {
            menu(student_id, name);
        } else {
            cout << "Invalid name or Student ID.\n";
            pause();
        }
    }
};

#endif

